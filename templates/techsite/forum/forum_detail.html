{% extends 'base.html' %}
{% load static %}
{% load social_share %}
{% load crispy_forms_tags %}
{% block title %} {{ forum.title }} | TechWif {% endblock %}
{% block meta_extend %}
    <meta property="og:title" content="{{ forum.title }}" />
    <meta property="og:site_name" content="TechWif" />
    <meta property="og:url" content="https://www.techwif.com/{{ forum.get_absolute_url }}" />
    <meta property="og:description" content="{{ forum.content|safe }}" />
    <meta property="og:type" content="article" />
    {% for f in forum.forumimages_set.all %}
    <meta property="og:image" content="{{ f.image.url }}" />
    {% endfor %}

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="TechWif" />
    <meta name="og:title" content="{{ forum.title }}" />
    <meta name="twitter:description" content="{{ forum.content }}" />
    <meta name="twitter:creator" content="/techwif" />
    {% for f in forum.forumimages_set.all %}
    <meta name="twitter:image" content="{{ f.image.url }}" />
    {% endfor %}
{% endblock %}
{% block content %}

    <div class="container mt-4 mb-4">
        <div class="row article-text">
            <div class="col-lg-6 p-0">
                <div class="title-block">
                    <h5>{{ forum.title|capfirst }}</h5>
                    by <a href="{% url 'profile_view' forum.author.username %}">{{ forum.author }}</a>,
                    updated on {{ forum.created_date }}
                    <hr>
                    <div class="center">
                        {% for f in forum.forumimages_set.all %}
                            <img class="mt-2" width="100%" height="100%" src="{{ f.image.url }}" alt="">
                        {% endfor %}
                    </div>
                    <hr>
                    <div class="mt-2">
                        <ul class="social-share-grid">
                            <li>{% post_to_facebook object_or_url "<i class='fab fa-facebook fa-lg'></i>" %}</li>
                            <li>{% post_to_twitter forum.title object_or_url "<i class='fab fa-twitter fa-lg'></i>" %}</li>
                            <li>{% post_to_whatsapp object_or_url "<i class='fab fa-whatsapp fa-lg'></i>" %}</li>
                            <li>{% post_to_telegram forum.title object_or_url "<i class='fab fa-telegram fa-lg'></i>" %}</li>
                            <li>{% post_to_linkedin forum.title object_or_url "<i class='fab fa-linkedin fa-lg'></i>" %}</li>
                            <li>{% post_to_reddit forum.title object_or_url "<i class='fab fa-reddit fa-lg'></i>" %}</li>
                        </ul>   
                    </div>
                    <hr>
                </div>
                <div class="">
                    <div class="article-text">
                        {{ forum.content|safe|linebreaks|urlizetrunc:40 }}
                    </div>  
    
                    <div class="m-2 center">
                        {% if forum.author == user or user.is_superuser %}
                        <hr>
                        <a class="btn btn-secondary tf m-2" href="{% url 'forum_update' forum.slug forum.id %}"><i class="fas fa-edit"></i></a>
                        <a class="btn btn-secondary tf m-2" href="{% url 'forum_update_image' forum.slug forum.id %}"><i class="fas fa-camera"></i></a>
                        <a class="btn btn-danger tf m-2" href="{% url 'forum_delete' forum.slug forum.id %}"><i class="fas fa-trash-alt"></i></a>
                        <hr>
                        {% endif %}
                    </div>  
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-inline">
                    <div id="like-section">
                        {% include 'techsite/forum/like_section.html' %}
                    </div>
                    
                    {% if request.user == user %}
                    <div id="favourite-section">
                        {% if is_favourite %}
                        <a href="{% url 'favourite_posts' forum.slug forum.id %}">Remove from favourites</a>
                        {% else %}
                        <a href="{% url 'favourite_posts' forum.slug forum.id %}">Add to favourites</a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="main-comment-section">
                    {% include 'techsite/forum/comments.html' %}
                </div>          
            </div>
        </div>             
    </div>

{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function(event){
        $(document).on('click', '#like', function(event){
            event.preventDefault();
            var pk = $(this).attr('value');
            $.ajax({
                type: 'POST',
                url: '{% url "like_forum" %}',
                data: {'id':pk, 'csrfmiddlewaretoken': '{{ crsf_token }}' },
                dataType: 'json',
                success: function(response){
                    $('#like-section').html(response['form'])
                    console.log($('#like-section').html(response['form']));
                },
                error: function(rs, e){
                    console.log(rs.responseText);
                },
            });
        });
    });

    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],
        handler: function(direction) {   
        },
        offset: 'bottom-in-view',

        onBeforePageLoad: function() {
            $('.loading').show();
        },
        onAfterPageLoad: function() {
            $('.loading').hide();
        }
    });

    $(document).ready(function(e){
        $(function(){
            setTimeout(function(){
                $('.alert').slideUp(2000);
            }, 5000);
        });
    });

</script>
{% endblock %}