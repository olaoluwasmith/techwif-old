{% extends 'base.html' %}
{% load static %}
{% block title %} Forum | TechWif {% endblock %}
{% block meta_extend %}
    <meta name="description" content="Join the online community of techies. Create post, learn, share with others." />
	<meta property="og:image" content="{% static 'techwif\techwif-favicon.png' %}" />
{% endblock %}
{% block content %}

<div class="container">
    <div class="mt-4">
        <form class="form-inline" action="{% url 'forum_list' %}" method="GET">
            <input class="" type="text" placeholder="Search posts" aria-label="Search" name="q" value="{{ request.GET.q }}">
            <button class="btn btn-secondary tf" type="submit">Search</button>
        </form>
    </div>
    <hr>
    
    <div class="forum-wrapper mt-0">
        <div>
            <h4 class="" id="main-articles">Forum Sections</h4>

            <div>
                {% for item in sec_menu|dictsort:"section" %}
                    <a class="btn btn-outline-secondary btn-sm mt-2 tf" role="button" href="{% url 'section' item|slugify %}">{{ item }}</a>
                {% endfor %}
            </div>
            <hr>
            {% if user.is_authenticated %}
            <div class="center">
                <a class="btn btn-secondary tf btn-block" href="{% url 'forum_form' %}">Create Post</a>
            </div>
            <hr>
            {% else %}
            <div class="center">
                <a href="{% url 'login' %}" class="btn btn-primary btn-block tf">Login to create post.</a>
            </div>
            <hr>
            {% endif %}
        </div>
        <div>
            {% for forum in object_list %}
            <div class="media content-section article-text m-2">
                <div>
                    <img class="rounded-circle  article-img" src="{{ forum.author.profile.profile_pic.url }}" width="70" height="70" alt="">
                </div>
                <div class="media-body article-text">
                    <div class="article-metadata">
                        <a class="mr-2" href="{% url 'profile_view' forum.author.username %}">{{ forum.author }}</a>
                        <small class="text-muted">{{ forum.created_date }}</small>
                        <small class="text-muted"> | </small>
                        <a href="{{ forum.section.get_absolute_url }}"><small>{{ forum.section }}</small></a>
                    </div>
                    <div>
                        <strong><a class="" href="{{ forum.get_absolute_url }}" class="btn btn-outline-secondary btn-sm btn-block" role="button">{{ forum.title|capfirst }}</a></strong>
                    </div>               
                </div>       
            </div>
            {% empty %}
            <div class="card center m-4 p-4">
                <h5>No result found.</h5>
            </div>
            {% endfor %}
            <div class="container" style="text-align: center;">
                {% if is_paginated %}
                    {% if page_obj.has_previous %}
                        <a class="btn btn-outline-dark mb-4 mt-2 tf" href="?page=1">First</a>
                        <a class="btn btn-outline-dark mb-4 mt-2 tf" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                    {% endif %}
                {% for num in page_obj.paginator.page_range %}
            
                    {% if page_obj.number == num %}
                        <a class="btn btn-outline-dark mb-4 mt-2  active" href="?page={{ num }}">{{ num }}</a>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a class="btn btn-outline-dark mb-4 mt-2" href="?page={{ num }}">{{ num }}</a>
                    {% endif %}
            
                {% endfor %}
            
                {% if page_obj.has_next %}
                    <a class="btn btn-outline-dark mb-4 mt-2 tf" href="?page={{ page_obj.next_page_number }}">Next</a>
                    <a class="btn btn-outline-dark mb-4 mt-2 tf" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                {% endif %}
                
                {% endif %}
            </div>
        </div> 
    </div>             
</div>

{% endblock %}

{% block javascript %}
<script>

    $(document).ready(function(e){
        $(function(){
            setTimeout(function(){
                $('.alert').slideUp(2000);
            }, 5000);
        });
    });

</script>
{% endblock %}