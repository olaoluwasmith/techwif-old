{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load materializecss %}
{% block title %} Cart | Techwit {% endblock %}
{% block content %}
{% include 'ecommerce/navbar_ecommerce.html' %}

<div class="container">
    <div class="mt-4">
        <form class="form-inline" action="{% url 'store' %}" method="GET">
            <input class="" type="text" placeholder="Search store" aria-label="Search" name="q" value="{{ request.GET.q }}">
            <button class="btn btn-secondary tf" type="submit">Search</button>
        </form>
    </div>
    <hr>
    <img src="{% static 'images/ecommerce-12-1568x1045.jpg' %}" alt="" class="center mt-4 mb-4" width="100%" height="300">
    <div class="row">
        <div class="col-lg-12">
            <div class="box-element">
                <div class="cart-row">
                    <div style="flex: 2;">Items</div>
                    <div style="flex: 1;">Quantity</div>
                    <div style="flex: 1;">Amount</div>
                </div>

                {% for item in items %}
                <div class="cart-row">
                    <div style="flex: 2;">{{ item.product.name }}</div>
                    <div style="flex: 1;">
                        <div class="quantity">
                            <img data-product={{ item.product.id }} data-action="add" class="chg-quantity update-cart" src="{% static 'images/arrow-up.png' %}">
                            <h5 class="mt-2 mb-2"><small>{{ item.quantity }}</small></h5>
                            <img data-product={{ item.product.id }} data-action="remove" class="chg-quantity update-cart" src="{% static 'images/arrow-down.png' %}">
                        </div>                       
                    </div>
                    <div style="flex: 1;">&#8358;{{ item.get_total|intcomma }}</div>
                </div>
                {% endfor %}
            </div>
            
            <hr>
            <div class="">
                <h5>Total Amount: <strong>&#8358;{{ order.get_cart_total|intcomma }}</strong></h5>
                <p><a class="btn btn-dark left tf mb-2 mt-2" href="{% url 'checkout' %}">Checkout</a></p>              
            </div>       
            <br><br>
            <hr>
        </div>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],
        handler: function(direction) {   
        },
        offset: 'bottom-in-view',

        onBeforePageLoad: function() {
            $('.loading').show();
        },
        onAfterPageLoad: function() {
            $('.loading').hide();
        }
    });

    // Hiding message after form submission
    $(document).ready(function(e){
        $(function(){
            setTimeout(function(){
                $('.alert').slideUp(2000);
            }, 5000);
        });
    });

    // sticky navbar for store
    window.onscroll = function() {myFunction()};
    var navbar = document.getElementById("store-nav");
    var sticky = navbar.offsetTop;

    function myFunction() {
        if (window.pageYOffset >= sticky) {
            navbar.classList.add("sticky")
        } else {
            navbar.classList.remove("sticky");
        };
    };
</script>
{% endblock %}